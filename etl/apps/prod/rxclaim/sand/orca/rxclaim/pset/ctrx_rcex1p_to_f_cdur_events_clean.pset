!prototype|P|||$AI_MP/rcex1p_to_f_cdur_clean.mp
MAPPING_XFR||||let max_sk=0;\r\nout :: reformat(in) =\r\nbegin\r\n  out.* :: in.*;\r\n  out.src_env_sk :: in.rxt_src_envrt_id;\r\n  out.claim_match_ind :: "N";\r\n  out.dxf_src_rec_cnt :: max_sk + ((next_in_sequence() )* number_of_partitions()) + this_partition(); \r\nend;
TARGET_NAME||||rxclaim_ctrx.f_cdur_events_rcdrdp
RUN_ID||||0
LOOKUP_PASS_RECORD_TYPE||||record   \r\n        unsigned integer(8)  dxf_hk_part1 =  0;\r\n        unsigned integer(8)  dxf_hk_part2 =  0; \r\n        decimal("\\x01",0)   src_env_sk = NULL("");   \r\n        unsigned integer(8)    dxf_src_rec_cnt = 0;\r\n        decimal("\\x01", maximum_length=18)    rxclaimnbr;\r\n        decimal("\\x01", maximum_length=6)    clmseqnbr;\r\n        string("\\x01", maximum_length=1)    claimsts=NULL("");\r\n        string("\\x01", maximum_length=1)   claim_match_ind;\r\n        decimal("\\x01", maximum_length=18)    d3p2nb = NULL("");\r\n        decimal("\\x01", maximum_length=6)    d3oinb = NULL("");\r\n        decimal("\\x01", maximum_length=6)    d3jjnb = NULL("");\r\n        string("\\x01", maximum_length=2)    d3l7st = NULL("");\r\n        string("\\x01", maximum_length=1)    d3l1st = NULL("");\r\n        string("\\x01", maximum_length=1)    d3l2st = NULL("");\r\n        decimal("\\x01", maximum_length=11)    d3aeda = NULL("");\r\n        decimal("\\x01".3, maximum_length=18)    d3jgnb = NULL("");\r\n        string("\\x01", maximum_length=1)    d3l3st = NULL("");\r\n        string("\\x01", maximum_length=1)    d3l8st = NULL("");\r\n        string("\\x01", maximum_length=30)    d3lvtx = NULL("");\r\n        string("\\x01", maximum_length=1)    d3aeh6 = NULL("");\r\n        string("\\x01", maximum_length=1)    d3afh6 = NULL("");\r\n        decimal("\\x01", maximum_length=5)    d3jdhr = NULL("");\r\n        string("\\x01", maximum_length=8)    d3nkcd = NULL("");\r\n        decimal("\\x01", maximum_length=18)    d3iqhr = NULL("");\r\n        decimal("\\x01", maximum_length=6)    d3irhr = NULL("");\r\n        decimal("\\x01", maximum_length=5)    d3ithr = NULL("");\r\n        decimal("\\x01", maximum_length=4)    d3bzik = NULL("");\r\n        decimal("\\x01", maximum_length=4)    d3b0ik = NULL("");\r\n        decimal("\\x01", maximum_length=5)    d3ishr = NULL("");\r\n        string("\\x01", maximum_length=1)    d3z5ha = NULL("");\r\n        decimal("\\x01", maximum_length=5)  d3iohr = NULL("");\r\n        decimal("\\x01", maximum_length=5)  d3iphr = NULL("");\r\n        datetime("YYYYMMDDHH24MISS")("\\x01")    ids_updt_dttm = NULL("");\r\nend
LOOKUP_KEY_RCDRDP||||{rxclaimnbr; clmseqnbr; src_env_sk}
IDS_LOOKUP_DATASET_RCDRDP_DML||||$[read_type(LOOKUP_ICFF_FILE_RCDRDP_DML)]
NORMALIZE_XFR|c|||include "${PUB_DXF_DML}/generic_data_types.dml" ;\r\nlet string("") datafile=this_partition_path("${LOOKUP_ICFF_FILE_RCDRDP}");\r\nlet string("") indexfile=this_partition_path(string_replace("${LOOKUP_ICFF_FILE_RCDRDP}",".dat.gz", ".idx"));\r\nlet  unsigned integer(8) v_hash_key_half=0;\r\nlet  ${IDS_LOOKUP_DATASET_RCDRDP_DML} lookup_record_type=allocate_with_defaults();\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML} lookup_record_value = allocate_with_nulls();\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML}[int] lookup_record_vec = [vector];\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML} exact_next_record_value=allocate_with_nulls();\r\nlet lookup_identifier_type current_lookup = lookup_not_loaded();\r\n\r\nout::length(in)=\r\nbegin\r\n        let int v_lkp_cnt = 0;\r\n        if (current_lookup == lookup_not_loaded()) \r\n                current_lookup = lookup_load(datafile /*@ eme_dataset_location: "${LOOKUP_ICFF_FILE_RCDRDP}" @*/,indexfile, "RCDRDP_REDUCED");\r\n        v_lkp_cnt = lookup_count(current_lookup, "RCDRDP_REDUCED", in.dxf_hk_part1);\r\n        lookup_record_vec = [vector];\r\n        if(v_lkp_cnt > 0) begin\r\n                lookup_record_value = lookup_last(current_lookup, "RCDRDP_REDUCED", in.dxf_hk_part1);\r\n                if(lookup_record_value.dxf_hk_part2 == in.dxf_hk_part2)\r\n                  lookup_record_vec = vector_append(lookup_record_vec, lookup_record_value);\r\n                for (let int k = 1, k < v_lkp_cnt)\r\n                begin \r\n                  exact_next_record_value = lookup_previous(current_lookup,"RCDRDP_REDUCED");\r\n                  if ( in.dxf_hk_part2 == exact_next_record_value.dxf_hk_part2 ) \r\n                  begin\r\n                    lookup_record_vec = vector_append(lookup_record_vec, exact_next_record_value);\r\n                  end\r\n                end\r\n        end\r\n        out :: if( length_of(lookup_record_vec) == 0 ) 1 else length_of(lookup_record_vec);\r\nend;\r\n\r\n\r\nout :: normalize( in, index) =\r\nbegin\r\n        out.* :1: if(length_of(lookup_record_vec) > 0) lookup_record_vec[index].*;\r\n        out.* :2: in.*;\r\n        out.claim_match_ind :: if(length_of(lookup_record_vec) > 0)  "Y" else "N";\r\n        out.d3irhr :1: if(length_of(lookup_record_vec) > 0) if(lookup_record_vec[index].d3irhr<0) lookup_record_vec[index].d3irhr else (1000-lookup_record_vec[index].d3irhr);\r\nend;
NORMALIZE_ARCHIVE_XFR|c|||include "${PUB_DXF_DML}/generic_data_types.dml" ;\r\nlet string("") datafile=this_partition_path("${LOOKUP_ICFF_ARCHIVE_FILE_RCDRDP}");\r\nlet string("") indexfile=this_partition_path(string_replace("${LOOKUP_ICFF_ARCHIVE_FILE_RCDRDP}",".dat.gz", ".idx"));\r\nlet  unsigned integer(8) v_hash_key_half=0;\r\nlet  ${IDS_LOOKUP_DATASET_RCDRDP_DML} lookup_record_type=allocate_with_defaults();\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML} lookup_record_value = allocate_with_nulls();\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML}[int] lookup_record_vec = [vector];\r\nlet ${IDS_LOOKUP_DATASET_RCDRDP_DML} exact_next_record_value=allocate_with_nulls();\r\nlet lookup_identifier_type current_lookup = lookup_not_loaded();\r\n\r\nout::length(in)=\r\nbegin\r\n        let int v_lkp_cnt = 0;\r\n        if (current_lookup == lookup_not_loaded()) \r\n                current_lookup = lookup_load(datafile /*@ eme_dataset_location: "${LOOKUP_ICFF_ARCHIVE_FILE_RCDRDP}" @*/,indexfile, "RCDRDP_REDUCED_ARCHIVE");\r\n        v_lkp_cnt = lookup_count(current_lookup, "RCDRDP_REDUCED_ARCHIVE", in.dxf_hk_part1);\r\n        lookup_record_vec = [vector];\r\n        if(v_lkp_cnt > 0) begin\r\n                lookup_record_value = lookup_last(current_lookup, "RCDRDP_REDUCED_ARCHIVE", in.dxf_hk_part1);\r\n                if(lookup_record_value.dxf_hk_part2 == in.dxf_hk_part2)\r\n                  lookup_record_vec = vector_append(lookup_record_vec, lookup_record_value);\r\n                for (let int k = 1, k < v_lkp_cnt)\r\n                begin \r\n                  exact_next_record_value = lookup_previous(current_lookup,"RCDRDP_REDUCED_ARCHIVE");\r\n                  if ( in.dxf_hk_part2 == exact_next_record_value.dxf_hk_part2 ) \r\n                  begin\r\n                    lookup_record_vec = vector_append(lookup_record_vec, exact_next_record_value);\r\n                  end\r\n                end\r\n        end\r\n        out :: if( length_of(lookup_record_vec) == 0 ) 1 else length_of(lookup_record_vec);\r\nend;\r\n\r\n\r\nout :: normalize( in, index) =\r\nbegin\r\n        out.* :1: if(length_of(lookup_record_vec) > 0) lookup_record_vec[index].*;\r\n        out.* :2: in.*;\r\n        out.claim_match_ind :: if(length_of(lookup_record_vec) > 0)  "Y" else "N";\r\n        out.d3irhr :1: if(length_of(lookup_record_vec) > 0) if(lookup_record_vec[index].d3irhr<0) lookup_record_vec[index].d3irhr else (1000-lookup_record_vec[index].d3irhr);\r\nend;
