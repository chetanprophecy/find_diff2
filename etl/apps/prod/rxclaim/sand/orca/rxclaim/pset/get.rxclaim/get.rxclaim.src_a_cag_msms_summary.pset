!prototype|P|||$AI_PSET/get.database.interim.pset
QUERY_TYPE_ID||||3
SOURCE_NAME||||rxclaim.src_a_cag_msms_summary
SOURCE_DB_PROJECT||||DB_RXCLAIM
SOURCE_TABLE_LIST||||# Schema Name Unqualified Table Name  Fields\nrxclaim       f_claim_transaction
SOURCE_DBMS_TYPE||||netezza
SOURCE_UNLOAD_INTERFACE||||api
SQL||||$[\n"select f.SRC_ENV_SK,\nf.cag_sk, \nf.subm_yr_mnth,\nb.ACTIVE_DAYS_ELIG_MBR_CNT_NO, \nb.AFTER_15th_ELIG_MBR_CNT_NO,\nf.MSMS_UTILIZING_MBR_CNT_NO,\nf.CLAIM_CNTR_RETAIL_30,\nf.CLAIM_CNTR_RETAIL_90,\nf.CLAIM_CNTR_HD,\nf.CLAIM_CNTR_MSMS_RETAIL_30,\nf.CLAIM_CNTR_MSMS_RETAIL_90,\nf.CLAIM_CNTR_MSMS_HD,\nf.HD_UTILIZING_MBR_CNT_NO,\nf.MSMS_MBR_OPT_OUT_CNT_NO\nfrom \n(select a.SRC_ENV_SK,\na.cag_sk, \na.subm_yr_mnth,\ncoalesce(count(distinct(case when (a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  and a.DAY_90_PROG_TYPE='M' ) then a.MBR_SK else null end )),0) as MSMS_UTILIZING_MBR_CNT_NO,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='N' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  and a.DAYS_SPLY <84 ) then a.CLAIM_CNTR else NULL end)),0)  as CLAIM_CNTR_RETAIL_30,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='N' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  and a.DAYS_SPLY >=84 ) then a.CLAIM_CNTR else NULL end)),0)  as CLAIM_CNTR_RETAIL_90,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='Y' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P') ) then a.CLAIM_CNTR else NULL end)),0) as CLAIM_CNTR_HD,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='N' and DAY_90_PROG_TYPE='M' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  and a.DAYS_SPLY <84 ) then a.CLAIM_CNTR else NULL end)),0) as CLAIM_CNTR_MSMS_RETAIL_30,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='N' and DAY_90_PROG_TYPE='M' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  and a.DAYS_SPLY >=84) then a.CLAIM_CNTR else NULL end)),0) as CLAIM_CNTR_MSMS_RETAIL_90,\ncoalesce(sum((Case when (a.HM_DLVRY_IND='Y' and DAY_90_PROG_TYPE='M' and a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')  ) then a.CLAIM_CNTR else NULL end)),0) as CLAIM_CNTR_MSMS_HD,\ncoalesce(count(distinct(case when (a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P') and a.HM_DLVRY_IND = 'Y' ) then a.MBR_SK else null end )),0) as HD_UTILIZING_MBR_CNT_NO,\ncoalesce(count(distinct (Case when (a.CLAIM_STAT_ID in ('C', 'P')  and a.DAY_90_PROG_TYPE='M' and a.CONSENT_TYPE_CD='O' and a.MEP_STAT_CD='A' ) \nand a.MEP_EFF_DT between date_trunc('month', a.SBM_DT) and last_day(a.SBM_DT) then a.MBR_SK else NULL end)),0) as MSMS_MBR_OPT_OUT_CNT_NO \nfrom (\nselect a.SRC_ENV_SK, a.cag_sk, a.subm_yr_mnth, a.RECENT_CLM_FLG,a.CLAIM_STAT_ID, a.DAY_90_PROG_TYPE, a.MBR_SK , a.HM_DLVRY_IND,a.DAYS_SPLY,a.CLAIM_CNTR, c.CONSENT_TYPE_CD,\nc.MEP_STAT_CD, c.MEP_EFF_DT, a.SBM_DT,a.sbm_dt_sk\nfrom F_CLAIM_TRANSACTION a \nJOIN D_MSMS_CLIENT_CATEGORY b\non a.cag_sk=b.cag_sk \nleft outer join D_MEMBER_CONSENT c \non a.mbr_sk=c.mbr_sk \nwhere a.subm_yr_mnth = to_char(to_date('" +  START_CHANGES_TIME + "', 'YYYY-MM-DD HH24:MI:SS'),'YYYYMM') AND a.RECENT_CLM_FLG = 'Y' and a.CLAIM_STAT_ID in ('C', 'P')\n) a group by a.SRC_ENV_SK, a.cag_sk, a.subm_yr_mnth ) f\n\nleft outer join (SELECT b.SRC_ENV_SK, b.CAG_SK,CAL_YR_MNTH_ID,sum(ACTIVE_DAYS_ELIG_MBR_CNT_NO) as ACTIVE_DAYS_ELIG_MBR_CNT_NO, sum(AFTER_15th_ELIG_MBR_CNT_NO) as AFTER_15th_ELIG_MBR_CNT_NO\n  FROM  A_CAG_MEMBER_MONTH b\n    join L_PERIOD_TYPE c\non b.PERD_TYPE_SK=c.PERD_TYPE_SK and c.PERD_TYPE_NM='Month'\njoin D_DATE d on\nb.PERD_START_DT_SK= d.DT_SK and CAL_YR_MNTH_ID = to_char(to_date('" +  START_CHANGES_TIME + "', 'YYYY-MM-DD HH24:MI:SS'),'YYYYMM') \ngroup by b.SRC_ENV_SK, b.CAG_SK,CAL_YR_MNTH_ID) b\n\non f.CAG_SK=b.CAG_SK and f.subm_yr_mnth=b.CAL_YR_MNTH_ID AND f.SRC_ENV_SK = b.SRC_ENV_SK"\n]
DO_CLEAN||||1
